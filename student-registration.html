<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SGBIT Placement Portal - Student Registration</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .registration-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .form-grid .field {
      margin-bottom: 15px;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    .skills-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .skill-tag {
      background: #e3f2fd;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid #2196f3;
    }
    .skill-tag.selected {
      background: #2196f3;
      color: white;
    }
    .file-upload {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    .file-upload:hover {
      border-color: #2196f3;
    }
    .file-upload.dragover {
      border-color: #2196f3;
      background-color: #f5f5f5;
    }
    .success-message {
      background: #4caf50;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }
    .error-message {
      background: #f44336;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"></div>
        <div class="brand-title">SGBIT Placement Recruitment</div>
      </div>
      <div class="header-actions">
        <a href="index.html" class="button secondary">‚Üê Back to Login</a>
        <a href="admin.html" class="button">Admin Dashboard</a>
      </div>
    </header>

    <div class="registration-container">
      <section class="card">
        <h2>Student Registration</h2>
        <p class="muted">Fill in your details to register for placement opportunities.</p>
        
        <!-- Success Message -->
        <div id="success-message" class="success-message" style="display: none;">
          <h3>‚úÖ Registration Successful!</h3>
          <p>Your details have been saved successfully. You can now access the placement portal.</p>
          <div class="actions" style="justify-content: center; margin-top: 15px;">
            <button class="button" onclick="resetForm()">Register Another Student</button>
            <a href="admin.html" class="button secondary">View All Students</a>
          </div>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="error-message" style="display: none;">
          <h3>‚ùå Registration Failed</h3>
          <p id="error-text"></p>
        </div>

        <!-- Registration Form -->
        <form class="form" id="student-registration-form">
          <div class="form-grid">
            <!-- Personal Information -->
            <div class="field">
              <label for="first-name">First Name *</label>
              <input id="first-name" type="text" placeholder="Enter your first name" required />
            </div>
            <div class="field">
              <label for="last-name">Last Name *</label>
              <input id="last-name" type="text" placeholder="Enter your last name" required />
            </div>
            <div class="field">
              <label for="usn">USN *</label>
              <input id="usn" type="text" placeholder="e.g., 1SG20CS001" required />
            </div>
            <div class="field">
              <label for="gender">Gender *</label>
              <select id="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="field">
              <label for="email">Email Address *</label>
              <input id="email" type="email" placeholder="your.email@example.com" required />
            </div>
            <div class="field">
              <label for="phone">Phone Number *</label>
              <input id="phone" type="tel" placeholder="+91 9876543210" required />
            </div>

            <!-- Academic Information -->
            <div class="field">
              <label for="department">Department *</label>
              <select id="department" required>
                <option value="">Select Department</option>
                <option value="CSE">Computer Science Engineering (CSE)</option>
                <option value="ECE">Electronics & Communication Engineering (ECE)</option>
                <option value="EEE">Electrical & Electronics Engineering (EEE)</option>
                <option value="MECH">Mechanical Engineering (MECH)</option>
                <option value="CIVIL">Civil Engineering (CIVIL)</option>
              </select>
            </div>
            <div class="field">
              <label for="batch">Batch Year *</label>
              <select id="batch" required>
                <option value="">Select Batch</option>
                <option value="2018">2018</option>
                <option value="2019">2019</option>
                <option value="2020">2020</option>
                <option value="2021">2021</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025">2025</option>
              </select>
            </div>
            <div class="field full-width">
              <label for="domain">Area of Specialization *</label>
              <input id="domain" type="text" placeholder="e.g., Web Development, Data Science, Machine Learning" required />
            </div>

            <!-- Skills Section -->
            <div class="field full-width">
              <label>Technical Skills *</label>
              <div class="skills-container" id="skills-container">
                <div class="skill-tag" data-skill="Java">Java</div>
                <div class="skill-tag" data-skill="Python">Python</div>
                <div class="skill-tag" data-skill="JavaScript">JavaScript</div>
                <div class="skill-tag" data-skill="React">React</div>
                <div class="skill-tag" data-skill="Node.js">Node.js</div>
                <div class="skill-tag" data-skill="SQL">SQL</div>
                <div class="skill-tag" data-skill="MongoDB">MongoDB</div>
                <div class="skill-tag" data-skill="C++">C++</div>
                <div class="skill-tag" data-skill="C">C</div>
                <div class="skill-tag" data-skill="Machine Learning">Machine Learning</div>
                <div class="skill-tag" data-skill="Data Science">Data Science</div>
                <div class="skill-tag" data-skill="Android">Android</div>
                <div class="skill-tag" data-skill="iOS">iOS</div>
                <div class="skill-tag" data-skill="AWS">AWS</div>
                <div class="skill-tag" data-skill="Docker">Docker</div>
                <div class="skill-tag" data-skill="Git">Git</div>
                <div class="skill-tag" data-skill="Linux">Linux</div>
                <div class="skill-tag" data-skill="Cybersecurity">Cybersecurity</div>
                <div class="skill-tag" data-skill="Blockchain">Blockchain</div>
                <div class="skill-tag" data-skill="IoT">IoT</div>
              </div>
              <input type="hidden" id="selected-skills" />
              <small class="muted">Click on skills to select them. You can also add custom skills below.</small>
            </div>

            <div class="field full-width">
              <label for="custom-skills">Additional Skills (comma-separated)</label>
              <input id="custom-skills" type="text" placeholder="e.g., TensorFlow, Spring Boot, Angular" />
            </div>

            <!-- Resume Upload -->
            <div class="field full-width">
              <label>Resume Upload (PDF only)</label>
              <div class="file-upload" id="file-upload">
                <p>üìÑ Click to upload or drag and drop your resume (PDF)</p>
                <p class="muted">Maximum file size: 10MB</p>
                <input type="file" id="resume-file" accept=".pdf" style="display: none;" />
              </div>
              <div id="file-info" style="display: none; margin-top: 10px;">
                <p><strong>Selected file:</strong> <span id="file-name"></span></p>
                <button type="button" class="button secondary" onclick="removeFile()">Remove File</button>
              </div>
            </div>
          </div>

          <div class="actions">
            <button class="button" type="submit">Register Student</button>
            <button class="button secondary" type="button" onclick="resetForm()">Reset Form</button>
          </div>
        </form>
      </section>
    </div>

    <footer class="footer">¬© 2025 Placement Portal. Demo only.</footer>
  </div>

  <script>
    (function() {
      const _origin = (window.location && window.location.origin) || '';
      const _isHttp = _origin.startsWith('http://') || _origin.startsWith('https://');
      const API_BASE_URL = (_isHttp ? _origin : 'http://localhost:3000') + '/api';
      // Use relative PHP path so it works under http://localhost/project/
      const PHP_BASE_URL = '';
      let selectedSkills = [];

      // Initialize skills selection
      function initSkills() {
        const skillTags = document.querySelectorAll('.skill-tag');
        skillTags.forEach(tag => {
          tag.addEventListener('click', function() {
            const skill = this.dataset.skill;
            if (this.classList.contains('selected')) {
              this.classList.remove('selected');
              selectedSkills = selectedSkills.filter(s => s !== skill);
            } else {
              this.classList.add('selected');
              selectedSkills.push(skill);
            }
            updateSkillsInput();
          });
        });
      }

      function updateSkillsInput() {
        const customSkills = document.getElementById('custom-skills').value;
        const allSkills = [...selectedSkills];
        
        if (customSkills.trim()) {
          const customSkillsArray = customSkills.split(',').map(s => s.trim()).filter(s => s);
          allSkills.push(...customSkillsArray);
        }
        
        document.getElementById('selected-skills').value = allSkills.join(', ');
      }

      // File upload handling
      function initFileUpload() {
        const fileUpload = document.getElementById('file-upload');
        const fileInput = document.getElementById('resume-file');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');

        fileUpload.addEventListener('click', () => fileInput.click());

        fileUpload.addEventListener('dragover', (e) => {
          e.preventDefault();
          fileUpload.classList.add('dragover');
        });

        fileUpload.addEventListener('dragleave', () => {
          fileUpload.classList.remove('dragover');
        });

        fileUpload.addEventListener('drop', (e) => {
          e.preventDefault();
          fileUpload.classList.remove('dragover');
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handleFileSelect(files[0]);
          }
        });

        fileInput.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
          }
        });

        function handleFileSelect(file) {
          if (file.type !== 'application/pdf') {
            alert('Please select a PDF file only.');
            return;
          }
          if (file.size > 10 * 1024 * 1024) {
            alert('File size must be less than 10MB.');
            return;
          }
          
          fileName.textContent = file.name;
          fileInfo.style.display = 'block';
        }
      }

      function removeFile() {
        document.getElementById('resume-file').value = '';
        document.getElementById('file-info').style.display = 'none';
      }

      // Form submission
      document.getElementById('student-registration-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Hide previous messages
        document.getElementById('success-message').style.display = 'none';
        document.getElementById('error-message').style.display = 'none';

        // Get form data
        const formData = new FormData();
        formData.append('first_name', document.getElementById('first-name').value.trim());
        formData.append('last_name', document.getElementById('last-name').value.trim());
        formData.append('usn', document.getElementById('usn').value.trim());
        formData.append('gender', document.getElementById('gender').value);
        formData.append('email', document.getElementById('email').value.trim().toLowerCase());
        formData.append('phone', document.getElementById('phone').value.trim());
        formData.append('department', document.getElementById('department').value);
        formData.append('batch', document.getElementById('batch').value);
        formData.append('domain', document.getElementById('domain').value.trim());
        
        // Update skills
        updateSkillsInput();
        formData.append('skills', document.getElementById('selected-skills').value);

        // Add resume file if selected
        const resumeFile = document.getElementById('resume-file').files[0];
        if (resumeFile) {
          formData.append('resume', resumeFile);
        }

        try {
          // Prefer PHP endpoint (XAMPP) if available
          const endpoint = `php/register_student.php`;
          const response = await fetch(endpoint, {
            method: 'POST',
            body: formData
          });

          const result = await response.json();

          if (response.ok) {
            document.getElementById('success-message').style.display = 'block';
            document.getElementById('student-registration-form').style.display = 'none';
          } else {
            throw new Error(result.error || 'Registration failed');
          }
        } catch (error) {
          document.getElementById('error-text').textContent = error.message;
          document.getElementById('error-message').style.display = 'block';
        }
      });

      // Reset form function
      window.resetForm = function() {
        document.getElementById('student-registration-form').reset();
        document.getElementById('success-message').style.display = 'none';
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('student-registration-form').style.display = 'block';
        
        // Reset skills
        selectedSkills = [];
        document.querySelectorAll('.skill-tag').forEach(tag => tag.classList.remove('selected'));
        document.getElementById('selected-skills').value = '';
        
        // Reset file upload
        removeFile();
      };

      // Initialize everything
      initSkills();
      initFileUpload();

      // Update skills when custom skills change
      document.getElementById('custom-skills').addEventListener('input', updateSkillsInput);
    })();
  </script>
</body>
</html>
